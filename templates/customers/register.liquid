<div id="CustomerRegisterForm">
  <h1>{{ 'customer.register.title' | t }}</h1>
  <p class="invited-message hide">Please, check your inbox for your account activation to log in! Or we can send you another one, click <a class="invited-link">here</a>!</p>

  {% form 'create_customer' %}

  <label for="FirstName">
    {{ 'customer.register.first_name' | t }}
  </label>
  <input type="text"
    name="customer[first_name]"
    id="FirstName"
    placeholder="{{ 'customer.register.first_name' | t }}"
    autofocus
    {% if form.first_name %}value="{{ form.first_name }}"{% endif %}>

  <label for="LastName">
    {{ 'customer.register.last_name' | t }}
  </label>
  <input type="text"
    name="customer[last_name]"
    id="LastName"
    placeholder="{{ 'customer.register.last_name' | t }}"
    {% if form.last_name %}value="{{ form.last_name }}"{% endif %}>

  <label for="Email">
    {{ 'customer.register.email' | t }}
  </label>
  <input type="email"
    name="customer[email]"
    id="Email"
    class="{% if form.errors contains 'email' %}input-error{% endif %}"
    placeholder="{{ 'customer.register.email' | t }}"
    value="{% if form.email %}{{ form.email }}{% endif %}"
    spellcheck="false"
    autocomplete="off"
    autocapitalize="off">

  <div class="CustomerPassword-wrapper">
    <label for="CreatePassword">
      {{ 'customer.register.password' | t }}
    </label>
    <input type="password"
      name="customer[password]"
      id="CreatePassword"
      class="inputPassword {% if form.errors contains 'password' %}input-error{% endif %}"
      placeholder="{{ 'customer.register.password' | t }}">
    <span class="showpass"></span>
  </div>

  <div class="registerBtn-wrapper">
    <a href="{{ shop.url }}" class="linkToHomepage">{{ 'customer.register.cancel' | t }}</a>
    <input type="submit" value="{{ 'customer.register.submit' | t }}" class="btn">
  </div>

  {% endform %}
</div>

<script>

  $('#CustomerRegisterForm .registerBtn-wrapper input.btn').click(function (e) {
    e.preventDefault();
    let customer_email = $('#Email').val();
    checkEmail(customer_email);
  });

  function checkEmail(customer_email) {
    $.ajax({
      type: "POST",
      url: "/apps/"+ window.theme.kitchenCentreKey +"/getCustomerState",
      dataType: "json",
      data: {
        email: customer_email
      },
      success: function(data) {
        console.log(data);
        if(data.state == 'invited' || data.state == 'disabled' ){
          showInvitedMessage(customer_email);
        }else{
          $('#create_customer').submit();
        }
      },
      error: function(XMLHttpRequest, textStatus) {
        console.log(textStatus);
        console.log(XMLHttpRequest);
      }
    });
  }

  function showInvitedMessage(customer_email) {
    $('.invited-message').removeClass('hide');
    $('.invited-link').attr('href', '/apps/'+ window.theme.kitchenCentreKey +'/trigger-activate-account/'+customer_email);
  }
</script>